machine:
  environment:
    HALCYON_BASE: /var/tmp/halcyon

dependencies:
  pre:
    - git clone https://github.com/mietek/halcyon.git $HOME/halcyon
    - mv rivet-core rivet
    - mv rivet-simple-deploy rivet
    - mv rivet-migration rivet
  override:
    - source <( $HOME/halcyon/halcyon paths ) && HALCYON_PREFIX=$HOME halcyon install rivet:
        timeout: 600
    
test:
  override:
    - echo 0

deployment:
  master:
    branch: master
    commands:
      - cd $HOME/bin && tar cvjf /tmp/rivet-ubuntu.bz2 rivet
      - source $HOME/halcyon/lib/bashmenot/src.sh && BASHMENOT_AWS_SECRET_ACCESS_KEY=$HALCYON_AWS_SECRET_ACCESS_KEY BASHMENOT_AWS_ACCESS_KEY_ID=$HALCYON_AWS_ACCESS_KEY_ID s3_upload /tmp/rivet-ubuntu.bz2 $HALCYON_S3_BUCKET rivet-ubuntu.bz2 public-read